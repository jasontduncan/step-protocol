# Phase 6 – Step 6.1: Fix bootstrap behavior for `worktree init`
status: done
started: 2025-11-25T21:30:40.579Z
completed: 2025-11-25T22:05:30.000Z

## Scope
Ensure `worktree init` follows WORK_PROTOCOL §3 (Node Bootstrap): · When PLAN.md exists and STATE.md does not, do not run the general PLAN–STATE validator. · Instead, parse PLAN.md and generate STATE.md with one row per step, with Status = `todo` and Progress Log = `-`. · Exit successfully after creating a consistent initial STATE. · Ensure that initialization errors are only raised for truly invalid situations (e.g., conflicting existing STATE, malformed PLAN), not for the normal bootstrap flow.

## Plan
- [x] Detect the PLAN-without-STATE bootstrap scenario before running any PLAN/STATE validator.
- [x] Parse existing PLAN.md, build fresh STATE rows, and write STATE.md atomically.
- [x] Only error when STATE.md already exists or PLAN.md is missing/malformed, keeping other flows idempotent.
- [x] Confirm the TypeScript build still succeeds after the refactor.

## Notes
- 2025-11-25T21:58:12Z Added a bootstrap branch in `WorkNode.initialize` so `worktree init` can seed STATE.md whenever only PLAN.md is present.
- 2025-11-25T22:00:05Z Introduced `buildInitialState` to reuse the PLAN→STATE transformation without running the cross-validator prematurely.
- 2025-11-25T22:03:15Z Ran `npm run build` to ensure the CLI still compiles with the new initialization paths.

## Outcomes
- `worktree init` now succeeds when PLAN.md exists without STATE.md, creating STATE.md rows with status `todo` and respecting the protocol.
- Initialization still fails fast when STATE.md already exists or when PLAN.md is missing/unreadable, avoiding spurious errors.
- The CLI build remains healthy after the change.
