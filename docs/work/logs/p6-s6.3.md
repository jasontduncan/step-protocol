# Phase 6 â€“ Step 6.3: Fix NODE_ROOT resolution in `worktree run`
status: done
started: 2025-11-25T23:55:00.000Z
completed: 2025-11-25T23:59:30.000Z

## Scope
Ensure `worktree run` derives its NODE_ROOT exactly the same way `worktree init` does: respect a positional directory argument, default to the current working directory, and validate the presence of PLAN.md, STATE.md, and logs/ in the chosen directory before loading a WorkNode.

## Plan
- [x] Rework `parseRunOptions` so run accepts a positional NODE_ROOT path or falls back to `process.cwd()` without assuming `docs/work/`.
- [x] Add explicit layout validation for the resolved NODE_ROOT and load the WorkNode from that validated layout.
- [x] Update CLI error handling so failures clearly mention the NODE_ROOT when validation or loading fails.
- [x] Confirm `npm run build` still succeeds after the CLI changes.

## Notes
- 2025-11-25T23:56:45Z Reworked `parseRunOptions` to default to `process.cwd()`, accept positional targets, and resolve them without appending any fixed layout.
- 2025-11-25T23:58:10Z Added explicit calls to `validateWorkNodeLayout` plus `WorkNode.loadFromLayout`, and improved the CLI error messages to mention the requested NODE_ROOT.
- 2025-11-25T23:59:15Z Ran `npm run build` to ensure the CLI still compiles after the refactor.

## Outcomes
- `worktree run` now derives its NODE_ROOT from a positional argument or the current working directory, without any hidden dependency on `docs/work/`.
- The command explicitly validates PLAN.md, STATE.md, and logs/ before loading a WorkNode and surfaces clear errors when that validation fails.
- The CLI still compiles cleanly after the changes.
